
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLB Prediction Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #1a3a76;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .games-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .game-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 600px;
            margin-bottom: 20px;
        }
        .game-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .team-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .team {
            text-align: center;
            width: 45%;
        }
        .vs {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 10%;
        }
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        .team-tables-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 15px;
        }
        .team-table-wrapper {
            width: 50%;
        }
        .team-table-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 5px;
            padding: 5px;
            background-color: #f2f2f2;
            border-radius: 4px;
        }
        .team-table {
            width: 100%;
            border-collapse: collapse;
        }
        .team-table th, .team-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .team-table th {
            background-color: #f2f2f2;
            font-weight: normal;
        }
        .pitcher-name {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        .dk-odds {
            font-weight: bold;
            margin-top: 10px;
        }
        .model-odds {
            font-size: 0.9em;
            color: #1a3a76;
            margin-top: 5px;
        }
        .fade-effect {
            opacity: 0;
            animation: fadeIn 0.8s forwards;
        }
        .win {
            color: green;
            font-weight: bold;
        }
        .loss {
            color: red;
        }
        .no-games {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>MLB Prediction Dashboard</h1>
        <p>Model Moneyline Predictions Using Different Game History Ranges</p>
    </div>

    <div class="games-container" id="gamesContainer">
        <!-- Game cards will be inserted here by JavaScript -->
    </div>

    <script>
        // Parse game data from Flask
        const gameData = JSON.parse('{{ game_data|safe }}');

        // Function to create game cards
        function createGameCards() {
            const container = document.getElementById('gamesContainer');
            
            // Show message if no games
            if (!gameData || gameData.length === 0) {
                const noGames = document.createElement('div');
                noGames.className = 'no-games';
                noGames.textContent = 'No upcoming games scheduled for today.';
                container.appendChild(noGames);
                return;
            }

            gameData.forEach((game, index) => {
                setTimeout(() => {
                    // Create game card element
                    const gameCard = document.createElement('div');
                    gameCard.className = 'game-card fade-effect';

                    // Create game header
                    const gameHeader = document.createElement('div');
                    gameHeader.className = 'game-header';
                    gameHeader.innerHTML = `
                        <h2>${game.away_team} @ ${game.home_team}</h2>
                        <div>${game.game_time}</div>
                    `;

                    // Get model ML for 5-game lookback (index 2 corresponds to 5 games in the range_data array)
                    let awayModelML, homeModelML;
                    const fiveGameData = game.range_data.find(d => d.num_games === 5);
                    if (fiveGameData) {
                        awayModelML = fiveGameData.favorite === game.away_team ? fiveGameData.fav_ml : fiveGameData.dog_ml;
                        homeModelML = fiveGameData.favorite === game.home_team ? fiveGameData.fav_ml : fiveGameData.dog_ml;
                        
                        // Format with + sign if positive
                        awayModelML = awayModelML > 0 ? `+${awayModelML}` : awayModelML;
                        homeModelML = homeModelML > 0 ? `+${homeModelML}` : homeModelML;
                    } else {
                        awayModelML = 'N/A';
                        homeModelML = 'N/A';
                    }

                    // Create team info section
                    const teamInfo = document.createElement('div');
                    teamInfo.className = 'team-info';
                    teamInfo.innerHTML = `
                        <div class="team">
                            <div>${game.away_team}</div>
                            <div class="pitcher-name">${game.away_pitcher || 'TBD'}</div>
                            <div class="dk-odds">DK ML: ${game.dk_away_odds}</div>
                            <div class="model-odds">Model ML: ${awayModelML}</div>
                        </div>
                        <div class="vs">@</div>
                        <div class="team">
                            <div>${game.home_team}</div>
                            <div class="pitcher-name">${game.home_pitcher || 'TBD'}</div>
                            <div class="dk-odds">DK ML: ${game.dk_home_odds}</div>
                            <div class="model-odds">Model ML: ${homeModelML}</div>
                        </div>
                    `;

                    // Create chart container
                    const chartContainer = document.createElement('div');
                    chartContainer.className = 'chart-container';
                    const canvas = document.createElement('canvas');
                    canvas.id = `chart-${index}`;
                    chartContainer.appendChild(canvas);

                    // Create team tables container
                    const teamTablesContainer = document.createElement('div');
                    teamTablesContainer.className = 'team-tables-container';

                    // Create away team table
                    const awayTableWrapper = document.createElement('div');
                    awayTableWrapper.className = 'team-table-wrapper';
                    
                    const awayTableTitle = document.createElement('div');
                    awayTableTitle.className = 'team-table-title';
                    awayTableTitle.textContent = `${game.away_team} Last 5 Games`;
                    
                    const awayTable = document.createElement('table');
                    awayTable.className = 'team-table';
                    
                    // Create away team table header
                    const awayThead = document.createElement('thead');
                    awayThead.innerHTML = `
                        <tr>
                            <th>Date</th>
                            <th>Opponent</th>
                            <th>Result</th>
                        </tr>
                    `;
                    
                    // Create away team table body
                    const awayTbody = document.createElement('tbody');
                    if (game.away_team_last_games && game.away_team_last_games.length > 0) {
                        game.away_team_last_games.forEach(gameData => {
                            const tr = document.createElement('tr');
                            const resultClass = gameData.result.startsWith('W') ? 'win' : 'loss';
                            tr.innerHTML = `
                                <td>${gameData.formatted_date}</td>
                                <td>${gameData.formatted_opponent}</td>
                                <td class="${resultClass}">${gameData.result}</td>
                            `;
                            awayTbody.appendChild(tr);
                        });
                    } else {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `<td colspan="3">No recent games available</td>`;
                        awayTbody.appendChild(tr);
                    }
                    
                    awayTable.appendChild(awayThead);
                    awayTable.appendChild(awayTbody);
                    awayTableWrapper.appendChild(awayTableTitle);
                    awayTableWrapper.appendChild(awayTable);

                    // Create home team table
                    const homeTableWrapper = document.createElement('div');
                    homeTableWrapper.className = 'team-table-wrapper';
                    
                    const homeTableTitle = document.createElement('div');
                    homeTableTitle.className = 'team-table-title';
                    homeTableTitle.textContent = `${game.home_team} Last 5 Games`;
                    
                    const homeTable = document.createElement('table');
                    homeTable.className = 'team-table';
                    
                    // Create home team table header
                    const homeThead = document.createElement('thead');
                    homeThead.innerHTML = `
                        <tr>
                            <th>Date</th>
                            <th>Opponent</th>
                            <th>Result</th>
                        </tr>
                    `;
                    
                    // Create home team table body
                    const homeTbody = document.createElement('tbody');
                    if (game.home_team_last_games && game.home_team_last_games.length > 0) {
                        game.home_team_last_games.forEach(gameData => {
                            const tr = document.createElement('tr');
                            const resultClass = gameData.result.startsWith('W') ? 'win' : 'loss';
                            tr.innerHTML = `
                                <td>${gameData.formatted_date}</td>
                                <td>${gameData.formatted_opponent}</td>
                                <td class="${resultClass}">${gameData.result}</td>
                            `;
                            homeTbody.appendChild(tr);
                        });
                    } else {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `<td colspan="3">No recent games available</td>`;
                        homeTbody.appendChild(tr);
                    }
                    
                    homeTable.appendChild(homeThead);
                    homeTable.appendChild(homeTbody);
                    homeTableWrapper.appendChild(homeTableTitle);
                    homeTableWrapper.appendChild(homeTable);

                    // Add tables to container
                    teamTablesContainer.appendChild(awayTableWrapper);
                    teamTablesContainer.appendChild(homeTableWrapper);

                    // Assemble the card
                    gameCard.appendChild(gameHeader);
                    gameCard.appendChild(teamInfo);
                    gameCard.appendChild(chartContainer);
                    gameCard.appendChild(teamTablesContainer);

                    // Add card to container
                    container.appendChild(gameCard);

                    // Create chart
                    createChart(canvas.id, game);

                }, index * 100); // Stagger the animation
            });
        }

        // Function to create chart for a game
        function createChart(canvasId, game) {
            const ctx = document.getElementById(canvasId).getContext('2d');

            // Prepare data
            const labels = game.range_data.map(d => `${d.num_games} games`);
            const awayData = game.range_data.map(d => {
                return d.favorite === game.away_team ? d.fav_ml : d.dog_ml;
            });
            const homeData = game.range_data.map(d => {
                return d.favorite === game.home_team ? d.fav_ml : d.dog_ml;
            });

            // Create the chart
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: game.away_team,
                            data: awayData.map(ml => ml < 0 ? ml : ml),
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderWidth: 2,
                            tension: 0.1
                        },
                        {
                            label: game.home_team,
                            data: homeData.map(ml => ml < 0 ? ml : ml),
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderWidth: 2,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Moneyline'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Model ML by Historical Range'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.raw < 0) {
                                        label += context.raw;
                                    } else {
                                        label += '+' + context.raw;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize when the page loads
        window.onload = function() {
            createGameCards();
        };
    </script>
</body>
</html>
